var DimpFullmessage={quickreply:function(b){var c,a={};a[$F("folder")]=[$F("index")];$("msgData").hide();$("qreply").show();switch(b){case"reply":case"reply_all":case"reply_list":c="GetReplyData";break;case"forward_all":case"forward_body":case"forward_attachments":c="GetForwardData";break}DimpCore.doAction(c,{imp_compose:$F("composeCache"),type:b},a,this.msgTextCallback.bind(this))},msgTextCallback:function(b){if(!b.response){return}var d=b.response,a=((d.format=="html")&&!DimpCompose.editor_on),e=(d.identity===null)?$F("identity"):d.identity,c=DimpCompose.get_identity(e,a);$("identity","last_identity").invoke("setValue",e);DimpCompose.fillForm((c.id[2])?("\n"+c.sig+d.body):(d.body+"\n"+c.sig),d.header);if(d.fwd_list&&d.fwd_list.length){d.fwd_list.each(function(f){DimpCompose.addAttach(f.number,f.name,f.type,f.size)})}if(a){DimpCompose.toggleHtmlEditor(true)}if(d.imp_compose){$("composeCache").setValue(d.imp_compose)}},_clickHandler:function(b){if(b.isRightClick()){return}var a=orig=b.element(),c;while(Object.isElement(a)){c=a.readAttribute("id");switch(c){case"windowclose":window.close();b.stop();return;case"forward_link":case"reply_link":this.quickreply(c=="reply_link"?"reply":DIMP.conf.forward_default);b.stop();return;case"button_deleted":case"button_ham":case"button_spam":DIMP.baseWindow.DimpBase.flag(c.substring(7),DIMP.conf.msg_index,DIMP.conf.msg_folder);window.close();b.stop();return;case"ctx_replypopdown_reply":case"ctx_replypopdown_reply_all":case"ctx_replypopdown_reply_list":this.quickreply(c.substring(17));break;case"ctx_fwdpopdown_forward_all":case"ctx_fwdpopdown_forward_body":case"ctx_fwdpopdown_forward_attachments":this.quickreply(c.substring(15));break;case"qreply":if(orig.match("DIV.headercloseimg IMG")){DimpCompose.confirmCancel()}break}a=a.up()}}};document.observe("dom:loaded",function(){window.focus();DimpCore.addPopdown("reply_link","replypopdown");DimpCore.addPopdown("forward_link","fwdpopdown");["from","to","cc","bcc","replyTo"].each(function(b){if(DimpFullmessage[b]){var c=$("msgHeader"+b.charAt(0).toUpperCase()+b.substring(1)).down("TD",1);c.replace(DimpCore.buildAddressLinks(DimpFullmessage[b],c.cloneNode(false)))}});document.observe("click",DimpFullmessage._clickHandler.bindAsEventListener(DimpFullmessage))});